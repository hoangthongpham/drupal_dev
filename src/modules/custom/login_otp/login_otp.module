<?php
use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Url;

function login_otp_mail($key, &$message, $params) {
    switch ($key) {
        case 'send_otp':
            $message['subject'] = $params['subject'];
            $message['body'][] = $params['message'];
            break;
    }
}

/**
 * Implements hook_preprocess_HOOK() to modify the menu.
 */
function login_otp_preprocess_menu__main(&$variables) {
    $user = \Drupal::currentUser();
    $items = &$variables['items'];

    // Remove old "Login with OTP" link if already exists.
    foreach ($items as $key => $item) {
        if ($item['title'] == 'Login with OTP' || $item['title'] == 'Logout') {
            unset($items[$key]);
        }
    }

    if ($user->isAnonymous()) {
        // Add Login with OTP link
        $items[] = [
            'title' => t('Login with OTP'),
            'url' => Url::fromRoute('login.otp_form'),
            'attributes' => ['class' => ['nav-item', 'nav-link']],
        ];
    } else {
        // Add Logout link
        $items[] = [
            'title' => t('Logout'),
            'url' => Url::fromRoute('user.logout'),
            'attributes' => ['class' => ['nav-item', 'nav-link', 'text-danger']],
        ];
    }
}